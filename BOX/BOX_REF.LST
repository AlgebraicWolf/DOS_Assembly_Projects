Turbo Assembler	 Version 4.1	    02/24/20 00:00:18	    Page 1
box_ref.asm



      1				     .186
      2	0000			     .model tiny
      3
      4				     locals @@
      5
      6	0000			     .data
      7
      8	0000  4A 75 73 74 20 6C	69+  Msg:	     db	'Just like DVD!', 0
      9	      6B 65 20 44 56 44	21+
     10	      00
     11	      =000E		     Len	     equ 14
     12	      =0003		     Del	     equ 3
     13	      =0070		     MainWindowColor	     equ 070h
     14	      =0080		     MainWindowShadow	     equ 80h
     15	000F			     .code
     16				     org 100h
     17
     18	0100			     Start:
     19	0100  FC				     cld
     20	0101  B8 1003				     mov ax, 1003h
     21	0104  B3 00				     mov bl, 0h
     22	0106  CD 10				     int 10h
     23	0108  B4 01				     mov ah, 01h
     24	010A  B1 20				     mov cl, 20h
     25	010C  B5 20				     mov ch, 20h
     26	010E  CD 10				     int 10h
     27	0110  B8 B800				     mov ax, 0b800h
     28	0113  8E C0				     mov es, ax
     29	0115  E8 0213				     call ClearScreen
     30	0118  E8 0021				     call Zoom
     31	011B  BF 0000				     mov di, 0
     32	011E  B9 0050				     mov cx, 80d
     33	0121  BA 0019				     mov dx, 25d
     34	0124  B4 00				     mov ah, 00h
     35	0126  B0 70				     mov al, MainWindowColor
     36	0128  E8 018B				     call DrawBox
     37	012B  B5 05				     mov ch, 5d
     38	012D  B1 03				     mov cl, 3d
     39	012F  B4 01				     mov ah, 1d
     40	0131  B0 01				     mov al, 1d
     41	0133  50				     push ax
     42	0134  BA 9E00				     mov dx, 9e00h
     43	0137  E8 0030				     call Animation
     44	013A  CD 20				     int 20h
     45
     46	013C			     Zoom    proc
     47	013C  B5 0B				     mov ch, 11d
     48	013E  B1 0B				     mov cl, 11d
     49	0140  E8 0126				     call CalcPosition
     50	0143  53				     push bx
     51	0144  6A 03				     push 3
     52	0146  6A 3A				     push 58
     53	0148			     @@Cycle:
     54	0148  59 5A 5F				     pop cx dx di
     55	014B  81 EF 00A2			     sub di, 162d
     56	014F  83 C1 02				     add cx, 2
     57	0152  83 C2 02				     add dx, 2
Turbo Assembler	 Version 4.1	    02/24/20 00:00:18	    Page 2
box_ref.asm



     58	0155  83 F9 4E				     cmp cx, 78
     59	0158  73 0F				     jae @@EndCycle
     60	015A  57 52 51				     push di dx	cx
     61	015D  B4 80				     mov ah, MainWindowShadow
     62	015F  B0 70				     mov al, MainWindowColor
     63	0161  E8 0152				     call DrawBox
     64	0164  E8 009B				     call Delay
     65	0167  EB DF				     jmp @@Cycle
     66	0169			     @@EndCycle:
     67	0169  C3				     ret
     68	016A			     Zoom    endp
     69
     70	016A			     Animation proc
     71	016A  50				     push ax
     72	016B			     @@AnimCycle:
     73	016B  E8 0080				     call DrawRoutine
     74	016E  58				     pop ax
     75	016F  02 EC				     add ch, ah
     76	0171  02 C8				     add cl, al
     77	0173  E8 0010				     call CollisionCheck
     78	0176  50				     push ax
     79	0177  E8 0003				     call KeyTerminate
     80	017A  EB EF				     jmp @@AnimCycle
     81	017C  C3				     ret
     82	017D			     Animation endp
     83
     84				     ;===============================================
     85				     ; Terminates program if any key is	pressed
     86				     ; DESTR: AH
     87				     ;===============================================
     88	017D			     KeyTerminate    proc
     89	017D  B4 01				     mov ah, 01h
     90	017F  CD 16				     int 16h
     91	0181  74 02				     jz	@@Continue
     92	0183  CD 20				     int 20h
     93	0185  C3		     @@Continue:     ret
     94	0186			     KeyTerminate    endp
     95
     96
     97	0186			     CollisionCheck  proc
     98	0186  80 FD 15				     cmp ch, 21
     99	0189  72 0A				     jb	@@SkipBottom
    100	018B  80 C6 10				     add dh, 10000b
    101	018E  B5 15				     mov ch, 21
    102	0190  B4 FF				     mov ah, -1
    103	0192  EB 0D 90				     jmp @@SkipTop
    104	0195  80 FD 01		     @@SkipBottom:   cmp ch, 1
    105	0198  77 07				     ja	@@SkipTop
    106	019A  80 C6 10				     add dh, 10000b
    107	019D  B5 01				     mov ch, 1
    108	019F  B4 01				     mov ah, 1
    109	01A1  80 F9 01		     @@SkipTop:	     cmp cl, 1
    110	01A4  77 0A				     ja	@@SkipLeft
    111	01A6  80 C6 10				     add dh, 10000b
    112	01A9  B1 01				     mov cl, 1
    113	01AB  B0 01				     mov al, 1
    114	01AD  EB 19 90				     jmp @@SkipRight
Turbo Assembler	 Version 4.1	    02/24/20 00:00:18	    Page 3
box_ref.asm



    115	01B0  8A D1		     @@SkipLeft:     mov dl, cl
    116	01B2  80 C2 0E				     add dl, Len
    117	01B5  FE C2				     inc dl
    118	01B7  80 FA 4E				     cmp dl, 78
    119	01BA  72 0C				     jb	@@SkipRight
    120	01BC  80 C6 10				     add dh, 10000b
    121	01BF  B0 FF				     mov al, -1
    122	01C1  8A CA				     mov cl, dl
    123	01C3  FE C9				     dec cl
    124	01C5  80 E9 0E				     sub cl, Len
    125	01C8			     @@SkipRight:
    126	01C8  80 E6 70				     and dh, 01110000b
    127	01CB  80 FE 00				     cmp dh, 0
    128	01CE  77 06				     ja	@@SkipBlackReset
    129	01D0  80 C6 10				     add dh, 10000b
    130	01D3  EB 09 90				     jmp @@SkipWhiteReset
    131	01D6			     @@SkipBlackReset:
    132	01D6  80 FE 70				     cmp dh, 01110000b
    133	01D9  72 03				     jb	@@SkipWhiteReset
    134	01DB  80 C6 20				     add dh, 100000b
    135	01DE			     @@SkipWhiteReset:
    136	01DE  8A D6				     mov dl, dh
    137	01E0  C0 EA 04				     shr dl, 4
    138	01E3  F6 D2				     not dl
    139	01E5  80 E2 0F				     and dl, 1111b
    140	01E8  02 F2				     add dh, dl
    141	01EA  80 CE 88				     or	dh, 10001000b
    142	01ED  C3				     ret
    143	01EE			     CollisionCheck endp
    144
    145	01EE			     DrawRoutine     proc
    146	01EE  52				     push dx
    147	01EF  51				     push cx
    148	01F0  51				     push cx
    149	01F1  51				     push cx
    150	01F2  52				     push dx
    151	01F3  E8 0086				     call WriteText
    152	01F6  5A				     pop dx
    153	01F7  59				     pop cx
    154	01F8  E8 0007				     call Delay
    155	01FB  59				     pop cx
    156	01FC  E8 0019				     call ClearText
    157	01FF  59				     pop cx
    158	0200  5A				     pop dx
    159	0201  C3				     ret
    160	0202			     DrawRoutine     endp
    161
    162				     ;================================================
    163				     ; Function	that performs delay
    164				     ;================================================
    165
    166	0202			     Delay   proc
    167	0202  B4 01				     mov ah, 01h
    168	0204  B9 0000				     mov cx, 0
    169	0207  BA 0000				     mov dx, 0
    170	020A  CD 1A				     int 1ah
    171	020C  B4 00				     mov ah, 00h
Turbo Assembler	 Version 4.1	    02/24/20 00:00:18	    Page 4
box_ref.asm



    172	020E  CD 1A		     @@Cycle:	     int 1ah
    173	0210  83 FA 03				     cmp dx, Del
    174	0213  73 02				     jae @@EndDelay
    175	0215  EB F7				     jmp @@Cycle
    176	0217  C3		     @@EndDelay:     ret
    177	0218			     Delay   endp
    178
    179
    180				     ;================================================
    181				     ; Procedure that removes the drawn	box as well as
    182				     ; the text, disabling shadow
    183				     ;================================================
    184	0218			     ClearText	     proc
    185	0218  E8 004E				     call CalcPosition
    186	021B  8B FB				     mov di, bx
    187	021D  B9 0010				     mov cx, Len + 2
    188	0220  E8 003F				     call ClearLine
    189	0223  B9 0002				     mov cx, 2
    190	0226  B4 70				     mov ah, MainWindowColor
    191	0228  E8 0079				     call CastShadow
    192
    193	022B  81 C3 00A0			     add bx, 160d
    194	022F  8B FB				     mov di, bx
    195	0231  B9 0010				     mov cx, Len + 2
    196	0234  E8 002B				     call ClearLine
    197	0237  B9 0002				     mov cx, 2
    198	023A  B4 70				     mov ah, MainWindowColor
    199	023C  E8 0065				     call CastShadow
    200
    201	023F  81 C3 00A0			     add bx, 160d
    202	0243  8B FB				     mov di, bx
    203	0245  B9 0010				     mov cx, Len + 2
    204	0248  E8 0017				     call ClearLine
    205	024B  B9 0002				     mov cx, 2
    206	024E  B4 70				     mov ah, MainWindowColor
    207	0250  E8 0051				     call CastShadow
    208
    209	0253  81 C3 00A0			     add bx, 160d
    210	0257  8B FB				     mov di, bx
    211	0259  B9 0012				     mov cx, Len + 4
    212	025C  B4 70				     mov ah, MainWindowColor
    213	025E  E8 0043				     call CastShadow
    214	0261  C3				     ret
    215	0262			     ClearText endp
    216
    217				     ;================================================
    218				     ; Function	that removes line of text
    219				     ; ENTER: CX - Length of line
    220				     ;		      DI - Pointer to the line
    221				     ; DESTR: DI, CX, AX
    222				     ;================================================
    223
    224	0262			     ClearLine	     proc
    225	0262  B4 70				     mov ah, MainWindowColor
    226	0264  B0 00				     mov al, 00h
    227	0266  F3> AB				     rep stosw
    228	0268  C3				     ret
Turbo Assembler	 Version 4.1	    02/24/20 00:00:18	    Page 5
box_ref.asm



    229	0269			     ClearLine	     endp
    230
    231				     ;================================================
    232				     ; Function	that calculates	current	position of
    233				     ; the text
    234				     ; ENTER:	     CH	- X coordinate of the text
    235				     ;		     CL	- Y coordinate of the text
    236				     ; EXIT: BX	- Current position of the text
    237				     ; DESTR: BX CX
    238				     ;================================================
    239
    240	0269			     CalcPosition    proc
    241	0269  33 DB				     xor bx, bx
    242	026B  8A DD				     mov bl, ch
    243	026D  C1 E3 02				     shl bx, 2
    244	0270  02 DD				     add bl, ch
    245	0272  C1 E3 04				     shl bx, 4
    246	0275  B5 00				     mov ch, 0
    247	0277  03 D9				     add bx, cx
    248	0279  D1 E3				     shl bx, 1
    249	027B  C3				     ret
    250	027C			     CalcPosition    endp
    251				     ;================================================
    252				     ; Function	that prints text in a box
    253				     ; ENTER: DI - Segment of Video RAM
    254				     ; DESTR: SI, DI, AX, BX, CX, DX
    255				     ;================================================
    256
    257	027C			     WriteText	     proc
    258	027C  E8 FFEA				     call CalcPosition ; Calculate TextBox position
    259	027F  8B FB				     mov di, bx
    260	0281  B9 0010				     mov cx, Len + 2
    261	0284  8A E6				     mov ah, dh
    262	0286  8A C6				     mov al, dh
    263						     ;or al, 00001111b
    264	0288  80 E4 7F				     and ah, 01111111b
    265	028B  BA 0003				     mov dx, 3
    266	028E  53				     push bx
    267	028F  E8 0024				     call DrawBox
    268	0292  5B				     pop bx
    269	0293  81 C3 00A2			     add bx, 162d ; Move to the	text position
    270	0297  8B FB				     mov di, bx
    271	0299  BE 0000r				     mov si, offset Msg
    272	029C  B9 000E				     mov cx, len
    273	029F			     @@WritingCycle:
    274	029F  A4				     movsb
    275	02A0  47				     inc di
    276	02A1  E2 FC				     loop @@WritingCycle
    277	02A3  C3				     ret ; Return
    278	02A4			     WriteText	     endp
    279
    280				     ;================================================
    281				     ; Function	that casts shadow
    282				     ; ENTER: CX - Length of shadow
    283				     ;	      ES - Video RAM Segment
    284				     ;	      AH - Shadow color
    285				     ;	      DI - Shift to shadow position
Turbo Assembler	 Version 4.1	    02/24/20 00:00:18	    Page 6
box_ref.asm



    286				     ; DESTR: CX, DI, AL
    287				     ;================================================
    288	02A4			     CastShadow	     proc
    289	02A4			     @@Cycle:
    290	02A4  26: 8A 45	01			     mov al, byte ptr es:[di+1]
    291	02A8  24 07				     and al, 07h
    292	02AA  80 E4 F0				     and ah, 0f0h
    293	02AD  02 E0				     add ah, al
    294	02AF  26: 8A 05				     mov al, byte ptr es:[di]
    295	02B2  AB				     stosw
    296	02B3  E2 EF				     loop @@Cycle
    297	02B5  C3				     ret
    298	02B6			     CastShadow	     endp
    299
    300				     ;================================================
    301				     ; Function	that draws box
    302				     ; ENTER: CX - Width (min: 2)
    303				     ;	      DX - Height (min:	2)
    304				     ;	      AH - Shadow color
    305				     ;	  AL - Text color
    306				     ;	      DI - Box position
    307				     ; DESTR: AX, BX, CX, DX, DI
    308				     ;================================================
    309	02B6			     DrawBox	     proc
    310	02B6  83 E9 02				     sub cx, 2
    311	02B9  83 EA 02				     sub dx, 2
    312	02BC  50 51				     push ax cx
    313	02BE  86 E0				     xchg ah, al
    314	02C0  B0 C9				     mov al, 0c9h
    315	02C2  BB CDBB				     mov bx, 0cdbbh
    316	02C5  E8 005A				     call DrawHorLine ;top line
    317	02C8  8B CA				     mov cx, dx
    318
    319	02CA			     @@Verticals:
    320	02CA  8B D1				     mov dx, cx
    321	02CC  59 58				     pop cx ax
    322	02CE  50 51				     push ax cx
    323	02D0  86 E0				     xchg ah, al
    324	02D2  B0 BA				     mov al, 0bah
    325	02D4  BB 00BA				     mov bx, 0bah
    326	02D7  81 C7 009C			     add di, 156d
    327	02DB  2B F9				     sub di, cx
    328	02DD  2B F9				     sub di, cx
    329	02DF  E8 0040				     call DrawHorLine
    330	02E2  59 58				     pop cx ax
    331	02E4  50 51				     push ax cx
    332	02E6  B9 0002				     mov cx, 2
    333	02E9  E8 FFB8				     call CastShadow
    334						     ;pop cx ax
    335						     ;push ax cx
    336	02EC  83 EF 04				     sub di, 4
    337	02EF  8B CA				     mov cx, dx
    338	02F1  E2 D7				     loop @@Verticals
    339
    340	02F3  59 58				     pop cx ax
    341	02F5  50 51				     push ax cx
    342	02F7  86 E0				     xchg ah, al
Turbo Assembler	 Version 4.1	    02/24/20 00:00:18	    Page 7
box_ref.asm



    343	02F9  81 C7 009C			     add di, 156d
    344	02FD  2B F9				     sub di, cx
    345	02FF  2B F9				     sub di, cx
    346	0301  B0 C8				     mov al, 0c8h
    347	0303  BB CDBC				     mov bx, 0cdbch
    348	0306  E8 0019				     call DrawHorLine ;bottom line
    349	0309  59 58				     pop cx ax
    350	030B  51				     push cx
    351	030C  B9 0002				     mov cx, 2
    352	030F  E8 FF92				     call CastShadow
    353	0312  59				     pop cx
    354	0313  81 C7 009A			     add di, 154d
    355	0317  2B F9				     sub di, cx
    356	0319  2B F9				     sub di, cx
    357	031B  83 C1 03				     add cx, 3
    358	031E  E8 FF83				     call CastShadow
    359	0321  C3				     ret
    360	0322			     DrawBox	     endp
    361
    362				     ;================================================
    363				     ; Procedure that draws a horizontal line of desired
    364				     ; length with custom start, finish	and intermediate
    365				     ; symbols
    366				     ;
    367				     ; ENTER: CX - Number of repetitions of interm element
    368				     ;	      ES - Shift to Video RAM
    369				     ;	      DI - Position of line's first symbol
    370				     ;	      AH - Line	color
    371				     ;	      AL - First symbol
    372				     ;	      BL - Last	symbol
    373				     ;	      BH - Intermediate	symbol
    374				     ; EXIT:  DI - Position of the next	after last symbol
    375				     ; DESTR: CX, DI, AX
    376				     ;================================================
    377
    378	0322			     DrawHorLine     proc
    379	0322  AB				     stosw
    380	0323  8A C7				     mov al, bh
    381	0325  F3> AB				     rep stosw
    382	0327  8A C3				     mov al, bl
    383	0329  AB				     stosw
    384	032A  C3				     ret
    385	032B			     DrawHorLine     endp
    386
    387
    388				     ;================================================
    389				     ; Procedure that clears the whole screen
    390				     ; ENTER: ES - shift to video memort
    391				     ; DESTR: DI, AX, CX
    392				     ;================================================
    393	032B			     ClearScreen     proc
    394	032B  BF 0000				     mov di, 0b
    395	032E  B9 07D0				     mov cx, 80d * 25d
    396	0331  B8 0F00				     mov ax, 0F00h
    397	0334  F3> AB				     rep stosw
    398	0336  C3				     ret
    399	0337			     ClearScreen     endp
Turbo Assembler	 Version 4.1	    02/24/20 00:00:18	    Page 8
box_ref.asm



    400
    401				     end Start
Turbo Assembler	 Version 4.1	    02/24/20 00:00:18	    Page 9
Symbol Table




Symbol Name			  Type	 Value

??DATE				  Text	 "02/24/20"
??FILENAME			  Text	 "box_ref "
??TIME				  Text	 "00:00:17"
??VERSION			  Number 040A
@32BIT				  Text	 0
@@ANIMCYCLE			  Near	 DGROUP:016B
@@CONTINUE			  Near	 DGROUP:0185
@@CYCLE				  Near	 DGROUP:0148
@@CYCLE				  Near	 DGROUP:020E
@@CYCLE				  Near	 DGROUP:02A4
@@ENDCYCLE			  Near	 DGROUP:0169
@@ENDDELAY			  Near	 DGROUP:0217
@@SKIPBLACKRESET		  Near	 DGROUP:01D6
@@SKIPBOTTOM			  Near	 DGROUP:0195
@@SKIPLEFT			  Near	 DGROUP:01B0
@@SKIPRIGHT			  Near	 DGROUP:01C8
@@SKIPTOP			  Near	 DGROUP:01A1
@@SKIPWHITERESET		  Near	 DGROUP:01DE
@@VERTICALS			  Near	 DGROUP:02CA
@@WRITINGCYCLE			  Near	 DGROUP:029F
@CODE				  Text	 DGROUP
@CODESIZE			  Text	 0
@CPU				  Text	 0103H
@CURSEG				  Text	 _TEXT
@DATA				  Text	 DGROUP
@DATASIZE			  Text	 0
@FILENAME			  Text	 BOX_REF
@INTERFACE			  Text	 000H
@MODEL				  Text	 1
@STACK				  Text	 DGROUP
@WORDSIZE			  Text	 2
ANIMATION			  Near	 DGROUP:016A
CALCPOSITION			  Near	 DGROUP:0269
CASTSHADOW			  Near	 DGROUP:02A4
CLEARLINE			  Near	 DGROUP:0262
CLEARSCREEN			  Near	 DGROUP:032B
CLEARTEXT			  Near	 DGROUP:0218
COLLISIONCHECK			  Near	 DGROUP:0186
DEL				  Number 0003
DELAY				  Near	 DGROUP:0202
DRAWBOX				  Near	 DGROUP:02B6
DRAWHORLINE			  Near	 DGROUP:0322
DRAWROUTINE			  Near	 DGROUP:01EE
KEYTERMINATE			  Near	 DGROUP:017D
LEN				  Number 000E
MAINWINDOWCOLOR			  Number 0070
MAINWINDOWSHADOW		  Number 0080
MSG				  Near	 DGROUP:0000
START				  Near	 DGROUP:0100
WRITETEXT			  Near	 DGROUP:027C
ZOOM				  Near	 DGROUP:013C
Turbo Assembler	 Version 4.1	    02/24/20 00:00:18	    Page 10
Symbol Table




Groups & Segments		  Bit Size Align  Combine Class

DGROUP				  Group
  _DATA				  16  000F Word	  Public  DATA
  _TEXT				  16  0337 Word	  Public  CODE
